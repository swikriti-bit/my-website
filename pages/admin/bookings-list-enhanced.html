<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0">
    <title>Car Bookings - Auto Nexus Admin</title>
    
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/site-title-carousel/WEBpic.jpg">
    
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    
    <!-- Fontawesome CSS -->
    <link rel="stylesheet" href="assets/css/font-awesome.min.css">
    
    <!-- Feathericon CSS -->
    <link rel="stylesheet" href="assets/css/feathericon.min.css">
    
    <!-- Datatables CSS -->
    <link rel="stylesheet" href="assets/plugins/datatables/datatables.min.css">
    
    <!-- Main CSS -->
    <link rel="stylesheet" href="assets/css/style.css">
    
    <!-- Date Picker CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    
    <style>
        .booking-form-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .stats-card {
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-2px);
        }
        .badge-status {
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <!-- Main Wrapper -->
    <div class="main-wrapper">
        
        <!-- Header -->
        <div class="header">
            <!-- Logo -->
            <div class="header-left">
                <a href="index.html" class="logo">
                    <img src="../../assets/site-title-carousel/WEBpic.jpg" alt="Logo">
                </a>
                <a href="index.html" class="logo logo-small">
                    <img src="assets/img/logo-small.png" alt="Logo" width="30" height="30">
                </a>
            </div>
            <!-- /Logo -->
            
            <a href="javascript:void(0);" id="toggle_btn">
                <i class="fe fe-text-align-left"></i>
            </a>
            
            <div class="top-nav-search">
                <form>
                    <input type="text" class="form-control" placeholder="Search here">
                    <button class="btn" type="submit"><i class="fa fa-search"></i></button>
                </form>
            </div>
            
            <!-- Mobile Menu Toggle -->
            <a class="mobile_btn" id="mobile_btn">
                <i class="fa fa-bars"></i>
            </a>
            <!-- /Mobile Menu Toggle -->
            
            <!-- Header Right Menu -->
            <ul class="nav user-menu">
                <!-- Notifications -->
                <li class="nav-item dropdown noti-dropdown">
                    <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                        <i class="fe fe-bell"></i> <span class="badge badge-pill">3</span>
                    </a>
                    <div class="dropdown-menu notifications">
                        <div class="topnav-dropdown-header">
                            <span class="notification-title">Notifications</span>
                            <a href="javascript:void(0)" class="clear-noti"> Clear All </a>
                        </div>
                        <div class="noti-content">
                            <ul class="notification-list">
                                <li class="notification-message">
                                    <a href="#">
                                        <div class="media">
                                            <span class="avatar avatar-sm">
                                                <img class="avatar-img rounded-circle" alt="User Image" src="assets/img/doctors/doctor-thumb-01.jpg">
                                            </span>
                                            <div class="media-body">
                                                <p class="noti-details"><span class="noti-title">New booking</span> received</p>
                                                <p class="noti-time"><span class="notification-time">4 mins ago</span></p>
                                            </div>
                                        </div>
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </li>
                <!-- /Notifications -->
                
                <!-- User Menu -->
                <li class="nav-item dropdown has-arrow">
                    <a href="#" class="dropdown-toggle nav-link" data-toggle="dropdown">
                        <span class="user-img"><img class="rounded-circle" src="assets/img/profiles/avatar-01.jpg" width="31" alt="Ryan Taylor"></span>
                    </a>
                    <div class="dropdown-menu">
                        <div class="user-header">
                            <div class="avatar avatar-sm">
                                <img src="assets/img/profiles/avatar-01.jpg" alt="User Image" class="avatar-img rounded-circle">
                            </div>
                            <div class="user-text">
                                <h6>Ryan Taylor</h6>
                                <p class="text-muted mb-0">Administrator</p>
                            </div>
                        </div>
                        <a class="dropdown-item" href="profile.html">My Profile</a>
                        <a class="dropdown-item" href="settings.html">Settings</a>
                        <a class="dropdown-item" href="../../Index.html">Logout</a>
                    </div>
                </li>
                <!-- /User Menu -->
            </ul>
            <!-- /Header Right Menu -->
        </div>
        <!-- /Header -->
        
        <!-- Sidebar -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-inner slimscroll">
                <div id="sidebar-menu" class="sidebar-menu">
                    <ul>
                        <li class="menu-title"> 
                            <span>Main</span>
                        </li>
                        <li> 
                            <a href="index.html"><i class="fe fe-home"></i> <span>Dashboard</span></a>
                        </li>
                        <li class="active"> 
                            <a href="bookings-list-enhanced.html"><i class="fe fe-layout"></i> <span>Bookings</span></a>
                        </li>
                        <li> 
                            <a href="purchasing-orders.html"><i class="fe fe-shopping-cart"></i> <span>Purchasing Orders</span></a>
                        </li>
                        <li> 
                            <a href="users-list.html"><i class="fe fe-user"></i> <span>Users</span></a>
                        </li>
                        <li> 
                            <a href="testimonials.html"><i class="fe fe-star-o"></i> <span>Testimonials</span></a>
                        </li>
                        <li> 
                            <a href="transactions-list.html"><i class="fe fe-activity"></i> <span>Transactions</span></a>
                        </li>
                        <li> 
                            <a href="settings.html"><i class="fe fe-vector"></i> <span>Settings</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- /Sidebar -->
        
        <!-- Page Wrapper -->
        <div class="page-wrapper">
            <div class="content container-fluid">
                
                <!-- Page Header -->
                <div class="page-header">
                    <div class="row">
                        <div class="col-sm-12">
                            <h3 class="page-title">Car Bookings</h3>
                            <ul class="breadcrumb">
                                <li class="breadcrumb-item"><a href="index.html">Dashboard</a></li>
                                <li class="breadcrumb-item active">Bookings</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <!-- /Page Header -->
                
                <div class="row">
                    <div class="col-md-12">
                        <!-- New Booking Form -->
                        <div class="card card-shadow mb-3">
                            <div class="card-header bg-primary text-white">
                                <h5 class="card-title mb-0">
                                    <i class="fe fe-plus-circle"></i> New Car Booking
                                </h5>
                            </div>
                            <div class="card-body booking-form-section">
                                <form id="newBookingForm">
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="customerName">Customer Name *</label>
                                                <input type="text" class="form-control" id="customerName" required>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="customerEmail">Email Address *</label>
                                                <input type="email" class="form-control" id="customerEmail" required>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="customerPhone">Phone Number *</label>
                                                <input type="tel" class="form-control" id="customerPhone" required>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="carBrand">Car Brand *</label>
                                                <select class="form-control" id="carBrand" required>
                                                    <option value="">Select Brand</option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="carModel">Car Model *</label>
                                                <select class="form-control" id="carModel" required>
                                                    <option value="">Select Model</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-3">
                                            <div class="form-group">
                                                <label for="pickupLocation">Pickup Location *</label>
                                                <select class="form-control" id="pickupLocation" required>
                                                    <option value="">Select Location</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="pickupDate">Pickup Date *</label>
                                                <input type="text" class="form-control datepicker" id="pickupDate" required>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label for="returnDate">Return Date *</label>
                                                <input type="text" class="form-control datepicker" id="returnDate" required>
                                            </div>
                                        </div>
                                        <div class="col-md-2">
                                            <div class="form-group">
                                                <label>&nbsp;</label><br>
                                                <button type="submit" class="btn btn-success btn-block">
                                                    <i class="fe fe-check"></i> Book Now
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <label for="bookingNotes">Additional Notes</label>
                                                <textarea class="form-control" id="bookingNotes" rows="2" placeholder="Any special requirements..."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        
                        <!-- Booking Statistics -->
                        <div class="row mb-3">
                            <div class="col-md-3">
                                <div class="card bg-primary text-white stats-card">
                                    <div class="card-body">
                                        <h4 class="card-title" id="totalBookings">0</h4>
                                        <p class="card-text">Total Bookings</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-warning text-white stats-card">
                                    <div class="card-body">
                                        <h4 class="card-title" id="activeBookings">0</h4>
                                        <p class="card-text">Active Bookings</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-success text-white stats-card">
                                    <div class="card-body">
                                        <h4 class="card-title" id="completedBookings">0</h4>
                                        <p class="card-text">Completed</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="card bg-info text-white stats-card">
                                    <div class="card-body">
                                        <h4 class="card-title" id="totalRevenue">₹0</h4>
                                        <p class="card-text">Total Revenue</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Search and Filter Section -->
                        <div class="card card-shadow mb-3">
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label for="searchBooking">Search Bookings</label>
                                            <input type="text" class="form-control" id="searchBooking" placeholder="Search by name, email, booking ID...">
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="statusFilter">Filter by Status</label>
                                            <select class="form-control" id="statusFilter">
                                                <option value="">All Status</option>
                                                <option value="pending">Pending</option>
                                                <option value="confirmed">Confirmed</option>
                                                <option value="active">Active</option>
                                                <option value="completed">Completed</option>
                                                <option value="cancelled">Cancelled</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="form-group">
                                            <label for="brandFilter">Filter by Brand</label>
                                            <select class="form-control" id="brandFilter">
                                                <option value="">All Brands</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-md-2">
                                        <div class="form-group">
                                            <label>&nbsp;</label><br>
                                            <button class="btn btn-primary btn-block" onclick="applyFilters()">
                                                <i class="fe fe-search"></i> Apply
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-12">
                                        <button class="btn btn-secondary btn-sm" onclick="clearFilters()">
                                            <i class="fe fe-x"></i> Clear Filters
                                        </button>
                                        <button class="btn btn-success btn-sm ml-2" onclick="exportBookings()">
                                            <i class="fe fe-download"></i> Export to CSV
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bookings Table -->
                        <div class="card card-shadow">
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="datatable table table-hover table-center mb-0" id="bookingsTable">
                                        <thead>
                                            <tr>
                                                <th>Booking ID</th>
                                                <th>Your Name</th>
                                                <th>Contact Number</th>
                                                <th>Car Brands</th>
                                                <th>Locations in Accra</th>
                                                <th>Date</th>
                                                <th>Time</th>
                                                <th>Status</th>
                                                <th class="text-right">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody id="bookingsTableBody">
                                            <!-- Bookings will be loaded dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- /Bookings Table -->
                    </div>
                </div>
            </div>
        </div>
        <!-- /Page Wrapper -->
    </div>
    <!-- /Main Wrapper -->
    
    <!-- Booking Details Modal -->
    <div class="modal fade" id="bookingDetailsModal" tabindex="-1" role="dialog">
        <div class="modal-dialog modal-lg" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Booking Details</h5>
                    <button type="button" class="close" data-dismiss="modal">
                        <span>&times;</span>
                    </button>
                </div>
                <div class="modal-body" id="bookingDetailsContent">
                    <!-- Booking details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="updateBookingStatusModal()">Update Status</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- jQuery -->
    <script src="assets/js/jquery-3.2.1.min.js"></script>
    
    <!-- Bootstrap Core JS -->
    <script src="assets/js/popper.min.js"></script>
    <script src="assets/js/bootstrap.min.js"></script>
    
    <!-- Slimscroll JS -->
    <script src="assets/plugins/slimscroll/jquery.slimscroll.min.js"></script>
    
    <!-- Datatables JS -->
    <script src="assets/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="assets/plugins/datatables/datatables.min.js"></script>
    
    <!-- Custom JS -->
    <script src="assets/js/script.js"></script>
    
    <!-- Date Picker JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
    
    <!-- Bookings API -->
    <script src="../../api/bookings.js"></script>
    
    <script>
        let currentBookingId = null;
        let bookings = [];
        let filteredBookings = [];

        // Sample booking data
        const sampleBookings = [
            {
                "bookingId": "BK-1738257360001",
                "name": "John Doe",
                "contactNumber": "+233550746180",
                "carBrand": "Toyota",
                "location": "Tema",
                "date": "01/18/2026",
                "time": "10:43 AM",
                "status": "confirmed",
                "bookingDate": "2026-01-30T10:00:00.000Z"
            },
            {
                "bookingId": "BK-1738257360002",
                "name": "Jane Smith",
                "contactNumber": "+233205391507",
                "carBrand": "Nissan",
                "location": "Amasaman",
                "date": "01/20/2026",
                "time": "2:30 PM",
                "status": "active",
                "bookingDate": "2026-01-29T15:30:00.000Z"
            }
        ];

        // Initialize form
        function initializeForm() {
            // Populate car brands
            const carBrands = getCarBrands();
            const brandSelect = document.getElementById('carBrand');
            const brandFilter = document.getElementById('brandFilter');
            
            carBrands.forEach(brand => {
                brandSelect.innerHTML += `<option value="${brand}">${brand}</option>`;
                brandFilter.innerHTML += `<option value="${brand}">${brand}</option>`;
            });
            
            // Populate locations
            const locations = getAccraLocations();
            const locationSelect = document.getElementById('pickupLocation');
            locations.forEach(location => {
                locationSelect.innerHTML += `<option value="${location}">${location}</option>`;
            });
            
            // Initialize date pickers
            $('.datepicker').datepicker({
                format: 'mm/dd/yyyy',
                startDate: new Date(),
                autoclose: true
            });
            
            // Handle brand change to update models
            document.getElementById('carBrand').addEventListener('change', function() {
                const models = getCarModels(this.value);
                const modelSelect = document.getElementById('carModel');
                modelSelect.innerHTML = '<option value="">Select Model</option>';
                models.forEach(model => {
                    modelSelect.innerHTML += `<option value="${model}">${model}</option>`;
                });
            });
        }

        // Load bookings
        async function loadBookings() {
            try {
                if (typeof(Storage) !== "undefined") {
                    const storedBookings = JSON.parse(localStorage.getItem('bookings') || '[]');
                    if (storedBookings.length > 0) {
                        bookings = storedBookings;
                    } else {
                        bookings = sampleBookings;
                        localStorage.setItem('bookings', JSON.stringify(sampleBookings));
                    }
                } else {
                    bookings = sampleBookings;
                }
                
                filteredBookings = [...bookings];
                updateStatistics();
                renderBookings();
            } catch (error) {
                console.error('Error loading bookings:', error);
            }
        }

        // Update statistics
        function updateStatistics() {
            const totalBookings = bookings.length;
            const activeBookings = bookings.filter(b => b.status === 'active').length;
            const completedBookings = bookings.filter(b => b.status === 'completed').length;
            
            let totalRevenue = 0;
            bookings.forEach(booking => {
                if (booking.status === 'completed' || booking.status === 'active') {
                    totalRevenue += booking.price;
                }
            });
            
            document.getElementById('totalBookings').textContent = totalBookings;
            document.getElementById('activeBookings').textContent = activeBookings;
            document.getElementById('completedBookings').textContent = completedBookings;
            document.getElementById('totalRevenue').textContent = '₹' + totalRevenue.toLocaleString();
        }

        // Handle new booking form submission
        document.getElementById('newBookingForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const pickupDate = new Date(document.getElementById('pickupDate').value);
            const returnDate = new Date(document.getElementById('returnDate').value);
            const days = Math.ceil((returnDate - pickupDate) / (1000 * 60 * 60 * 24)) + 1;
            
            const booking = {
                bookingId: 'BK-' + Date.now(),
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmail').value,
                customerPhone: document.getElementById('customerPhone').value,
                carBrand: document.getElementById('carBrand').value,
                carModel: document.getElementById('carModel').value,
                pickupLocation: document.getElementById('pickupLocation').value,
                pickupDate: document.getElementById('pickupDate').value,
                returnDate: document.getElementById('returnDate').value,
                price: calculateBookingPrice(document.getElementById('carBrand').value, document.getElementById('carModel').value, days),
                status: 'pending',
                notes: document.getElementById('bookingNotes').value,
                bookingDate: new Date().toISOString()
            };
            
            try {
                const result = await saveBooking(booking);
                if (result.success) {
                    alert('Booking created successfully!');
                    document.getElementById('newBookingForm').reset();
                    loadBookings();
                } else {
                    alert('Failed to create booking: ' + result.message);
                }
            } catch (error) {
                console.error('Error creating booking:', error);
                alert('An error occurred while creating the booking');
            }
        });

        // Render bookings table
        function renderBookings() {
            if (filteredBookings.length === 0) {
                if ($.fn.DataTable.isDataTable('#bookingsTable')) {
                    $('#bookingsTable').DataTable().destroy();
                }
                document.getElementById('bookingsTableBody').innerHTML = '<tr><td colspan="10" class="text-center">No bookings found</td></tr>';
                return;
            }

            const tableData = filteredBookings.map((booking, index) => {
                const originalIndex = bookings.findIndex(b => b.bookingId === booking.bookingId);
                
                return [
                    booking.bookingId,
                    booking.customerName || booking.fullName || booking.name || 'N/A',
                    booking.contactNumber || booking.customerPhone || booking.phone || 'N/A',
                    booking.carBrand || booking.car || 'N/A',
                    booking.location || booking.pickupLocation || 'N/A',
                    booking.date || booking.pickupDate || 'N/A',
                    booking.time || 'N/A',
                    `<span class="badge badge-${getBookingStatusClass(booking.status)} badge-status">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span>`,
                    `<div class="text-right">
                        <button class="btn btn-sm btn-primary" onclick="viewBookingDetails(${originalIndex})">
                            <i class="fe fe-eye"></i> View
                        </button>
                        <button class="btn btn-sm btn-success" onclick="updateBookingStatusModal(${originalIndex})">
                            <i class="fe fe-edit"></i> Update
                        </button>
                    </div>`
                ];
            });

            if ($.fn.DataTable.isDataTable('#bookingsTable')) {
                $('#bookingsTable').DataTable().destroy();
            }

            $('#bookingsTable').DataTable({
                data: tableData,
                columns: [
                    { title: "Booking ID" },
                    { title: "Your Name" },
                    { title: "Contact Number" },
                    { title: "Car Brands" },
                    { title: "Locations in Accra" },
                    { title: "Date" },
                    { title: "Time" },
                    { title: "Status" },
                    { title: "Actions", orderable: false }
                ],
                "bFilter": false,
                "pageLength": 10
            });
        }

        // Get booking status class
        function getBookingStatusClass(status) {
            switch(status) {
                case 'confirmed': return 'info';
                case 'active': return 'primary';
                case 'completed': return 'success';
                case 'cancelled': return 'danger';
                case 'pending': return 'warning';
                default: return 'secondary';
            }
        }

        // View booking details
        function viewBookingDetails(index) {
            const booking = bookings[index];
            currentBookingId = index;
            
            const detailsHtml = `
                <div class="booking-details">
                    <h6>Booking Information</h6>
                    <table class="table table-bordered">
                        <tr><th>Booking ID:</th><td>${booking.bookingId}</td></tr>
                        <tr><th>Booking Date:</th><td>${new Date(booking.bookingDate).toLocaleDateString()}</td></tr>
                        <tr><th>Car:</th><td>${booking.carBrand} ${booking.carModel}</td></tr>
                        <tr><th>Pickup Location:</th><td>${booking.pickupLocation}</td></tr>
                        <tr><th>Pickup Date:</th><td>${booking.pickupDate}</td></tr>
                        <tr><th>Return Date:</th><td>${booking.returnDate}</td></tr>
                        <tr><th>Price:</th><td><strong>₹${booking.price}</strong></td></tr>
                        <tr><th>Status:</th><td><span class="badge badge-${getBookingStatusClass(booking.status)}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td></tr>
                    </table>
                    
                    <h6 class="mt-3">Customer Information</h6>
                    <table class="table table-bordered">
                        <tr><th>Your Name:</th><td>${booking.name || booking.customerName || booking.fullName || 'N/A'}</td></tr>
                        <tr><th>Contact Number:</th><td>${booking.contactNumber || booking.customerPhone || booking.phone || 'N/A'}</td></tr>
                    </table>
                    
                    <h6 class="mt-3">Booking Details</h6>
                    <table class="table table-bordered">
                        <tr><th>Car Brands:</th><td>${booking.carBrand || 'N/A'}</td></tr>
                        <tr><th>Locations in Accra:</th><td>${booking.location || booking.pickupLocation || 'N/A'}</td></tr>
                        <tr><th>Date:</th><td>${booking.date || booking.pickupDate || 'N/A'}</td></tr>
                        <tr><th>Time:</th><td>${booking.time || 'N/A'}</td></tr>
                        <tr><th>Status:</th><td><span class="badge badge-${getBookingStatusClass(booking.status)}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td></tr>
                    </table>
                </div>
            `;
            
            document.getElementById('bookingDetailsContent').innerHTML = detailsHtml;
            $('#bookingDetailsModal').modal('show');
        }

        // Update booking status modal
        function updateBookingStatusModal(index) {
            if (index !== undefined) {
                currentBookingId = index;
                viewBookingDetails(index);
            }
        }

        // Apply filters
        function applyFilters() {
            const searchTerm = document.getElementById('searchBooking').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const brandFilter = document.getElementById('brandFilter').value;
            
            filteredBookings = bookings.filter(booking => {
                const matchesSearch = !searchTerm || 
                    booking.bookingId.toLowerCase().includes(searchTerm) ||
                    booking.customerName.toLowerCase().includes(searchTerm) ||
                    booking.customerEmail.toLowerCase().includes(searchTerm) ||
                    booking.carBrand.toLowerCase().includes(searchTerm);
                
                const matchesStatus = !statusFilter || booking.status === statusFilter;
                const matchesBrand = !brandFilter || booking.carBrand === brandFilter;
                
                return matchesSearch && matchesStatus && matchesBrand;
            });
            
            renderBookings();
        }

        // Clear filters
        function clearFilters() {
            document.getElementById('searchBooking').value = '';
            document.getElementById('statusFilter').value = '';
            document.getElementById('brandFilter').value = '';
            filteredBookings = [...bookings];
            renderBookings();
        }

        // Export bookings to CSV
        function exportBookings() {
            let csv = 'Booking ID,Your Name,Contact Number,Car Brands,Locations in Accra,Date,Time,Status\n';
            
            filteredBookings.forEach(booking => {
                csv += `"${booking.bookingId}","${booking.name || booking.customerName || booking.fullName || 'N/A'}","${booking.contactNumber || booking.customerPhone || booking.phone || 'N/A'}","${booking.carBrand || 'N/A'}","${booking.location || booking.pickupLocation || 'N/A'}","${booking.date || booking.pickupDate || 'N/A'}","${booking.time || 'N/A'}","${booking.status}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.setAttribute('hidden', '');
            a.setAttribute('href', url);
            a.setAttribute('download', 'car_bookings_' + new Date().toISOString().split('T')[0] + '.csv');
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Initialize on page load
        $(document).ready(function() {
            initializeForm();
            loadBookings();
            
            // Auto-refresh every 30 seconds
            setInterval(loadBookings, 30000);
        });
    </script>
</body>
</html>
